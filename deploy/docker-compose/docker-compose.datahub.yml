services:
  # ─── DataHub Catalog (ADR-040) ─────────────────────────

  datahub-gms:
    image: acryldata/datahub-gms:latest
    environment:
      DATAHUB_ANALYTICS_ENABLED: "false"
      EBEAN_DATASOURCE_URL: jdbc:postgresql://postgres:5432/datahub
      EBEAN_DATASOURCE_USERNAME: odg
      EBEAN_DATASOURCE_PASSWORD: odg
      KAFKA_BOOTSTRAP_SERVER: kafka:9092
      ELASTICSEARCH_HOST: elasticsearch
      ELASTICSEARCH_PORT: "9200"
    ports:
      - "8080:8080"
    depends_on:
      - elasticsearch
      - kafka

  datahub-frontend:
    image: acryldata/datahub-frontend-react:latest
    environment:
      DATAHUB_GMS_HOST: datahub-gms
      DATAHUB_GMS_PORT: "8080"
      DATAHUB_SECRET: opendatagov-dev-secret
      DATAHUB_APP_VERSION: "1.0.0"
      DATAHUB_PLAY_MEM_BUFFER_SIZE: 10MB
      KAFKA_BOOTSTRAP_SERVER: kafka:9092
      ELASTIC_CLIENT_HOST: elasticsearch
      ELASTIC_CLIENT_PORT: "9200"
      DATAHUB_ANALYTICS_ENABLED: "false"
      DATAHUB_TRACKING_TOPIC: DataHubUsageEvent_v1
    ports:
      - "9002:9002"
    depends_on:
      - datahub-gms

  elasticsearch:
    image: elasticsearch:7.17.20
    environment:
      discovery.type: single-node
      ES_JAVA_OPTS: "-Xms256m -Xmx256m"
      xpack.security.enabled: "false"
    ports:
      - "9200:9200"
    volumes:
      - es_data:/usr/share/elasticsearch/data

volumes:
  es_data:
